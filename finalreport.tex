\documentclass[11pt]{article}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsfonts}
\usepackage{amsmath}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
%\def\wl{\par \vspace{\baselineskip}}

\begin{document}

% TITLE PAGE
\begin{titlepage}
	\begin{center}

% Header
\textsc{\LARGE AA241X: Design, Construction, and Testing of Autonomous Aircraft}\\
\HRule \\[0.4cm]
\includegraphics[width=1.0\textwidth]{./skynet}~\\
\HRule \\[0.4cm]
\textsc{\Large Final Report}\\
{\large \today}
\vfill

% Authors
\begin{minipage}{0.4\textwidth}
	\begin{flushleft} \large
	\emph{Authors:}\\[0.5cm]
	Kartikey Asthana\\
	\texttt{kasthana@stanford.edu}\\[0.5cm]
	Peter Blake\\
	\texttt{psblake@stanford.edu}\\[0.5cm]
	Brandon Jennings\\
	\texttt{bjennin@stanford.edu}\\[0.5cm]
	Erik Moon\\
	\texttt{emoon1@stanford.edu}\\[0.5cm]
	Sravya Nimmagadda\\
	\texttt{sravya@stanford.edu}\\[0.5cm]
	Akshay Subramaniam\\
	\texttt{akshays@stanford.edu}\\[0.5cm]
	Ian Villa\\
	\texttt{ianvilla@stanford.edu}\\[0.5cm]
	Jerry Watkins\\
	\texttt{watkins2@stanford.edu}\\[0.5cm]
\end{flushleft}
\end{minipage}
\begin{minipage}{0.4\textwidth}
	\begin{flushright} \large
	\emph{Degree \& Department:} \\[0.5cm]
	Ph.D. Candidate\\
	Aeronautics \& Astronautics\\[0.5cm]
	M.S. Candidate\\
	Graduate School of Business\\[0.5cm]
	M.S. Candidate\\
	Mechanical Engineering\\[0.5cm]
	M.S. Candidate\\
	Graduate School of Business\\[0.5cm]
	Ph.D. Candidate\\
	Aeronautics \& Astronautics\\[0.5cm]
	Ph.D. Candidate\\
	Aeronautics \& Astronautics\\[0.5cm]
	B.S. \& M.S. Candidate\\
	Aeronautics \& Astronautics\\[0.5cm]
	Ph.D. Candidate\\
	Aeronautics \& Astronautics\\[0.5cm]
\end{flushright}
\end{minipage}
\end{center}
\end{titlepage}

% TABLE OF CONTENTS
\clearpage
\tableofcontents
\vfill
\clearpage

\section{Introduction}
<<<<<<< HEAD
	\label{Introduction}
	Since the early 2000's, Stanford Aeronautics and Astronautics has taught the AA 241X: Design, Construction and Testing of Autonomous Aircraft course with various missions over the years. In Spring of 2014, teams were tasked with developing an autonomous aircraft to search and accurately locate four targets within the perimeter of Lake Lagunita. Among these teams was Skynet, a group of eight individuals from different backgrounds and expertise who, throughout the ten weeks, collaborated to organize, design, test, and fly various aircraft, guidance, control, and mission systems to optimally complete the search and rescue. The following report outlines the team's structure, mission strategy, aerodynamic design, control strategy, fabrication accounts, flight test data, and overall competition performance.

	\section{The Team}
		\label{Team}
		\subsection{Team Structure}
		\label{TeamStrc}
		Skynet began as a team of eight individuals from Stanford Aeronautics and Astronautics, Mechanical Engineering, and the Graduate School of Business. In order to effectively tackle the assigned problem sets and deadlines, the team began by designating Ian as team lead and the other members as sub team leaders in the different disciplines required by the class. These areas were Aerodynamics/Configuration Design/Propulsion, Guidance/Navigation/Control, Hardware/Fabrication, Software, Aircraft Performance, and Mission Planning as outlined in the first lecture by Professor Alonso. The initial team structure is outlined in Table~\ref{initTeam}.

		\begin{table}[!ht]
			\begin{center}
				\begin{tabular}{| p{7.5cm} | c | p{3.7cm} |}
					\hline
					\textbf{Initial Design Sub-Teams} & \textbf{Lead} & \textbf{Members} \\ \hline
					Aerodynamics/Configuration Design, Propellers/Propulsion & Jerry, Akshay, Kartikey & Sravya, Ian \\ \hline
					Guidance, Navigation \& Control & Brandon & Jerry, Sravya, Akshay \\ \hline
					Hardware & Erik & Brandon, Peter \\ \hline
					Software & Ian & Brandon, Erik, Jerry, Akshay, Sravya, Kartikey \\ \hline
					Aircraft Performance & Sravya & Jerry, Akshay, Ian, Peter, Kartikey \\ \hline
					Mission Planning & Peter & Everyone \\ \hline
					Fabrication & Erik & Brandon, Peter, Akshay, Jerry, Kartikey \\ \hline
				\end{tabular}
				\caption{Initial Team Divisions}
				\label{initTeam}
			\end{center}
		\end{table}

		For flying, our team had two designated pilots and launchers respectively as seen in Table~\ref{initFltTeam}. For each flight, at least one pilot was present and one launcher was present with a flight director also available depending on what code was being tested.

		\begin{table}[!ht]
			\begin{center}
				\begin{tabular}{| c | c |}
					\hline
					\textbf{Flight Team Role} & \textbf{Members} \\ \hline
					Pilots & Peter \& Brandon \\ \hline
					Launchers/Flight Directors & Jerry \& Ian \\ \hline
				\end{tabular}
				\caption{Initial Flight Team}
				\label{initFltTeam}
			\end{center}
		\end{table}

		As problem set tasks and goals were more concretely defined, the team structure evolved depending on the roles members acquired. Sub teams and member roles were redefined and grouped accordingly. Since software was strongly tied to the aircraft performance, mission planning, and guidance, navigation, \& control sub teams, the sub team was dissolved with a new focus on systems and logistics. As our mission strategy grew in complexity, Kartikey took the helm as lead with his specialties in numerics. Sub team integration and communication was aided by the fact that members in the flight team were leading separate design sub teams and that there was just the right amount of overlap between divisions. Mid-quarter team configurations are outlined in Table~\ref{midTeam}.

		\begin{table}[!ht]
			\begin{center}
				\begin{tabular}{| p{7.5cm} | c | p{3.7cm} |}
					\hline
					\textbf{Mid-Quarter Design Sub-Teams} & \textbf{Lead} & \textbf{Members} \\ \hline
					Aerodynamics/Configuration Design, Propellers/Propulsion & Akshay, Sravya & \\ \hline
					Guidance, Navigation \& Control & Brandon & Jerry, Ian, Peter \\ \hline
					Hardware/Fabrication & Erik & Brandon, Peter, Ian, Akshay \\ \hline
					Systems/Logistics & Ian & Brandon, Jerry \\ \hline
					Aircraft Performance & Sravya, Jerry & Akshay, Kartikey \\ \hline
					Mission Planning & Kartikey & Everyone \\ \hline
				\end{tabular}
				\caption{Mid-Quarter Team Divisions}
				\label{midTeam}
			\end{center}
		\end{table}

		From week eight onward, our aerodynamic design was finalized which meant that the aerodynamic divisions could be absorbed by the other sub teams. Because of the level of complexity of our mission strategy, we needed more time to port our matlab codes and functions to the APM which lead to a majority of the team working on software and a light, efficient squad left for fabrication and repairs. As flying became more critical, we decided on a primary pilot for testing and introduced other flight directors as needed for testing of specific pieces of code. Our final sub team layout and flight teams are in Table~\ref{finalTeam} and in Table~\ref{finalFltTeam} respectively.

		\begin{table}[!ht]
			\begin{center}
				\begin{tabular}{| p{7.5cm} | c | p{3.7cm} |}
					\hline
					\textbf{Final Design Sub-Teams} & \textbf{Lead} & \textbf{Members} \\ \hline
					Guidance, Navigation \& Control & Brandon & Jerry, Ian, Peter \\ \hline
					Hardware/Fabrication & Erik & Peter, Ian \\ \hline
					Systems/Logistics & Ian & Brandon, Jerry \\ \hline
					Mission Planning & Kartikey & Jerry, Akshay, Sravya \\ \hline
				\end{tabular}
				\caption{Final Team Divisions}
				\label{finalTeam}
			\end{center}
		\end{table}

		\begin{table}[!ht]
			\begin{center}
				\begin{tabular}{| c | c |}
					\hline
					\textbf{Flight Team Role} & \textbf{Members} \\ \hline
					Pilots & Peter (Competition) \& Brandon (Testing) \\ \hline
					Launchers & Jerry, Ian, Akshay, Kartikey \\ \hline
					Flight Directors & Brandon (Controls), Jerry (Phase 1), Akshay \& Kartikey (Phase 2), Ian (Backup) \\ \hline
				\end{tabular}
				\caption{Final Flight Team}
				\label{finalFltTeam}
			\end{center}
		\end{table}

		\subsection{Team Communication \& Logistics}
		\label{TeamCommLog}
		In order to facilitate group discussions, a when2meet form was utilized online. Based on its results, the team met briefly after class on Mondays and Wednesdays for brief sub team status updates and coordination. Major team meetings were held on Fridays during the typical class time on the second floor of Durand and were spent discussing topics requiring everyone's attendance such as aircraft design and mission strategy.

		The team also utilized online methods to meet communication needs. A Google Group was utilized for formalized notices and e-mail discussions. Short-form and quick information relays were handled by a GroupMe that could be accessed via phone or computer. 

		Prior to week 6, flight testing was scheduled as needed since precedence was placed on airframe and mission strategy development. However, once control laws and mission code needed to be tested in the air, it became apparent that a regular schedule needed to be enforced for sufficient project progress. Flight teams as outlined in Section~\ref{TeamStrc} met at Durand 353 nearly every day of the week at 6:00am. Once logs had been cleared and updates had been pushed to the APM, the flight team would head out to Lake Lagunita around 6:30am and fly until 11:00am on good days and 8:30am on bad days. Phone calls were used to communicate for the entire pre-flight and flight duration for real-time updates. Intermittent updates and summaries were sent to team members not present over the GroupMe. Towards the competition week, flight teams would arrive earlier to fly sooner.

		Data Storage and problem set completion was made possible via our Google Drive, Google Docs, Github, and a Wordpress. Actual APM code was managed via Github in order to take advantage of Github's version control capabilities. All other team data, simulation code, and photos were uploaded into categorically defined folders in our Google Drive. Spreadsheets recording budget, weather data, contact information, useful links, and most importantly, problem set requirements were also held here. Having all of these documents in a single location and accessible by all of the team was the last step in facilitating good communication and ensured proper problem set completion. Once written, relevant text, data, graphs, and videos were uploaded to skynet241x.wordpress.com.

		\section{Mission}
			\input{mission}
			\label{Mission}

			\section{Airframe Design}
				\label{Vehicle}

				\subsection{Propulsion System Analysis}

				The propulsion system analysis was performed in three parts:
				\begin{enumerate}
					\item Propeller analysis
					\item Motor analysis
					\item Propeller and Motor matching
				\end{enumerate}

				\subsubsection{Propeller Analysis}

				For the propeller analysis, we used wind tunnel experimental data from the UIUC Propeller Data Site \footnote{http://aerospace.illinois.edu/m-selig/props/propDB.html}. The exact same propeller data was unavailable in the database, so we used a very similar propeller (Graupner CAM Slim 9x5) albeit from a different manufacturer.

				The data was given in terms of the rotations per second instead of the angular velocity and hence, the following scaling had to be performed

				\begin{eqnarray*}
					\lambda &=& \frac{J}{\pi} \\
					C_T &=& \left( \frac{2}{3} \right)^3 C_T ^ \prime \\
					C_P &=& \frac{1}{\pi} \left( \frac{2}{3} \right)^3 C_P ^ \prime \\
					\eta &=& \eta ^ \prime
				\end{eqnarray*}
				where $\lambda$ is the advance ratio based on the angular velocity, $J$ is the advance ratio based on the rotations per second, $C_T$ is the thrust coefficient, $C_P$ is the power coefficient and $\eta$ is the propeller efficiency. The primed quantities are the ones reported in the database.

				\subsubsection{Motor Analysis}
				The motor analysis was performed by using the standard electric motor model. The motor speed constant, motor resistance and the no-load motor current were obtained from experimentally measured values on the manufacturer's website \footnote{http://www.maxxprod.com/pdf/HC2808-xxxx.pdf}.

				The values of the model constants are reported below:
				\begin{eqnarray*}
					K_v &=& 980 \left( \frac{2 \pi}{60} \right) \; rad/s/volt \\
					R_m &=& 0.220 \; \Omega \\
					i_0 &=& 0.4 \; A
				\end{eqnarray*}

				\subsubsection{Propeller and Motor Matching}
				For a given free-stream velocity, the required torque for the propeller was calculated as a function of the angular velocity of the propeller. For the motor, the torque generated was calculated as a function of the angular velocity. By matching these two torques, we solved for the angular velocity and obtained the total propulsive efficiency. This process is illustrated in Figure~\ref{fig:prop-motor1}.
				\begin{figure}[h!]
					\centering
					\begin{subfigure}[b]{0.49\textwidth}
						\includegraphics[width=\textwidth]{Figures/PS3/propmotor_v07p0.png}
						\caption{$v = 7 \; m/s$}
					\end{subfigure}
					\begin{subfigure}[b]{0.49\textwidth}
						\includegraphics[width=\textwidth]{Figures/PS3/propmotor_v12p0.png}
						\caption{$v = 12 \; m/s$}
=======
\label{Introduction}
Since the early 2000's, Stanford Aeronautics and Astronautics has taught the AA 241X: Design, Construction and Testing of Autonomous Aircraft course with various missions over the years. In Spring of 2014, teams were tasked with developing an autonomous aircraft to search and accurately locate four targets within the perimeter of Lake Lagunita. Among these teams was Skynet, a group of eight individuals from different backgrounds and expertise who, throughout the ten weeks, collaborated to organize, design, test, and fly various aircraft, guidance, control, and mission systems to optimally complete the search and rescue. The following report outlines the team's structure, mission strategy, aerodynamic design, control strategy, fabrication accounts, flight test data, and overall competition performance.

\section{The Team}
\label{Team}
\subsection{Team Structure}
\label{TeamStrc}
\subsection{Team Communication \& Logistics}
\label{TeamCommLog}
In order to facilitate group discussions, a when2meet form was utilized online. Based on its results, the team met briefly after class on Mondays and Wednesdays for brief sub team status updates and coordination. Major team meetings were held on Fridays during the typical class time on the second floor of Durand and were spent discussing topics requiring everyone's attendance such as aircraft design and mission strategy.

The team also utilized online methods to meet communication needs. A Google Group was utilized for formalized notices and e-mail discussions. Short-form and quick information relays were handled by a GroupMe that could be accessed via phone or computer.

Data Storage and problem set completion was made possible via our Google Drive, Google Docs, and a Wordpress. All team data, code, and photos were uploaded into categorically defined folders in our Google Drive. Spreadsheets recording budget, weather data, contact information, useful links, and most importantly, problem set requirements were also held here. Having all of these documents in a single location and accessible by all of the team was the last step in facilitating good communication and ensured proper problem set completion. Once written, relevant text, data, graphs, and videos were uploaded to skynet241x.wordpress.com.

\include{mission}

\section{Airframe Design}
\label{Vehicle}

\subsection{Propulsion System Analysis}

The propulsion system analysis was performed in three parts:
\begin{enumerate}
\item Propeller analysis
\item Motor analysis
\item Propeller and Motor matching
\end{enumerate}

\subsubsection{Propeller Analysis}

For the propeller analysis, we used wind tunnel experimental data from the UIUC Propeller Data Site \footnote{http://aerospace.illinois.edu/m-selig/props/propDB.html}. The exact same propeller data was unavailable in the database, so we used a very similar propeller (Graupner CAM Slim 9x5) albeit from a different manufacturer.

The data was given in terms of the rotations per second instead of the angular velocity and hence, the following scaling had to be performed

\begin{eqnarray*}
\lambda &=& \frac{J}{\pi} \\
C_T &=& \left( \frac{2}{3} \right)^3 C_T ^ \prime \\
C_P &=& \frac{1}{\pi} \left( \frac{2}{3} \right)^3 C_P ^ \prime \\
\eta &=& \eta ^ \prime
\end{eqnarray*}
where $\lambda$ is the advance ratio based on the angular velocity, $J$ is the advance ratio based on the rotations per second, $C_T$ is the thrust coefficient, $C_P$ is the power coefficient and $\eta$ is the propeller efficiency. The primed quantities are the ones reported in the database.

\subsubsection{Motor Analysis}
The motor analysis was performed by using the standard electric motor model. The motor speed constant, motor resistance and the no-load motor current were obtained from experimentally measured values on the manufacturer's website \footnote{http://www.maxxprod.com/pdf/HC2808-xxxx.pdf}.

The values of the model constants are reported below:
\begin{eqnarray*}
K_v &=& 980 \left( \frac{2 \pi}{60} \right) \; rad/s/volt \\
R_m &=& 0.220 \; \Omega \\
i_0 &=& 0.4 \; A
\end{eqnarray*}

\subsubsection{Propeller and Motor Matching}
For a given free-stream velocity, the required torque for the propeller was calculated as a function of the angular velocity of the propeller. For the motor, the torque generated was calculated as a function of the angular velocity. By matching these two torques, we solved for the angular velocity and obtained the total propulsive efficiency. This process is illustrated in Figure~\ref{fig:prop-motor1}.
\begin{figure}[h!]
  \centering
    \begin{subfigure}[b]{0.49\textwidth}
                \includegraphics[width=\textwidth]{Figures/PS3/propmotor_v07p0.png}
                \caption{$v = 7 \; m/s$}
        \end{subfigure}
        \begin{subfigure}[b]{0.49\textwidth}
                \includegraphics[width=\textwidth]{Figures/PS3/propmotor_v12p0.png}
                \caption{$v = 12 \; m/s$}
>>>>>>> 210f754f4a95fe8bad8791a8c3a916f38f8a1bdd
        \end{subfigure}%
        \caption{Propeller-Motor matching shown graphically. Solid lines: propeller curves. Dashed lines: Motor curves}\label{fig:prop-motor1}
    \end{figure}

    For the $7 \; ms^{-1}$ case, we see that the propeller efficiency, $\eta_p$ peaks at very low angular velocities and hence the total propulsive efficiency is poor. For the $12 \; ms^{-1}$ case, the propeller efficiency, $\eta_p$ peaks at high angular velocities which again leads to a low total propulsive efficiency. Optimizing the total propulsive efficiency over different airspeeds, we get the best motor-propeller matching illustrated in Figure~\ref{fig:prop-motor2}

    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=\textwidth]{Figures/PS3/propmotor_opt.png}
    	\caption{Optimal Propeller-Motor matching shown graphically. Solid lines: propeller curves. Dashed lines: Motor curves}\label{fig:prop-motor2}
    \end{figure}

    The total propulsive efficiency and the thrust are plotted against airspeed in Figure~\ref{fig:teff-thrust}.

    \begin{figure}[h!]
    	\centering
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/PS3/Teff.png}
    		\caption{Plot of the total propulsive efficiency against airspeed}
    	\end{subfigure}
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/PS3/Thrust.png}
    		\caption{Plot of the total thrust against airspeed}
        \end{subfigure}%
        \caption{Thrust and efficiency plots}\label{fig:teff-thrust}
    \end{figure}

    \subsection{Design Approach}
    \label{DsignAppr}

    For our mission plan, it is critical that we climb to an altitude of $400 ft$ as fast as we can to efficiently scout the search area and sight all four targets as soon as we can. Hence, the rate of climb for our airplane is of crucial importance. In addition to this, the endurance of our aircraft is also very important since the allowed battery consumption is very limiting. We designed our aircraft mainly based on these two considerations.

    First, we obtained the drag polar for a generic 2D semi-symmetrical airfoil section (Clark-Y) in XFLR5 that we used as our first estimates for our full aircraft drag polar. From some preliminary weight estimates, we allotted a $450g$ weight budget for our aircraft. Using this weight and the 2D drag polars data, we found the wing area that would maximize our rate of climb using the data from the analysis of the propulsion system. We chose a taper ratio of $0.5$ for our wing. This choice was influenced by structural constraints on the total root bending moment and the stall characteristics so that in the event of a stalled aircraft, aileron control is not lost. Then, we assumed an aspect ratio of $6.8$ (that of the Bixler 2). This allowed us to construct a wing in XFLR5 to get a more realistic drag polar. This process was repeated iteratively until convergence. However, we changed our aspect ratio to $10$ since we felt it would be possible to make a wing with that aspect ratio that is still rigid enough.

    After this preliminary analysis, we did the same analysis with different airfoil sections and chose the SD-7037 airfoil section since the predicted $(L/D)_{max}$ was the highest for this airfoil. The effect of the choice of airfoil section on the climb performance was found to be minimal and hence we were able to perform a decoupled analysis for the choice of airfoil sections.

    Then, we calculated the horizontal stabilizer area from considerations of the longitudinal stability that were backed by Vortex Lattice Model predictions. The vertical stabilizer size was chosen based on previous aircraft designs similar to our aircraft and then validated using stability analysis in AVL.

    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/SkynetV3_XFLR_pic.png}
    	\caption{VLM model of our design in XFLR5}\label{fig:vlm-design}
    \end{figure}

    \subsection{Performance Characteristics}
    \label{PerfChar}

    The different performance parameters of our design as predicted by XFLR5 are shown in Figures~\ref{fig:cl-alpha} to \ref{fig:power-cons}.

    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/CL_vs_alpha.png}
    	\caption{$C_L$ vs $\alpha$}\label{fig:cl-alpha}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/CL_vs_CD.png}
    	\caption{Drag polar}\label{fig:cl-cd}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/CL-CD_vs_V.png}
    	\caption{$C_L/C_D$ vs $v_\infty$}\label{fig:LD-v}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/Cm_vs_alpha.png}
    	\caption{$C_m$ vs $\alpha$}\label{fig:cm-alpha}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS3/power_consumption.png}
    	\caption{$P_{level}$ vs airspeed}\label{fig:power-cons}
    \end{figure}

    A comparison of the performance parameters estimated from our analysis with the performance parameters obtained from measured data during flight tests in shown in Table~\ref{table:Compar}.

    \begin{table}[htb]
    	\begin{center}
    		\begin{tabular}{|c|c|c|c|c|c|}
    			\hline
    			\textbf{} & \textbf{$C_L\;max$} & \textbf{$(L/D)_{max}$} & \textbf{$P_{level}$ $(9.5 \; ms^{-1})$} & $P_{level}$ $(13.5 \; ms^{-1})$  & \textbf{$P_{max\;climb}$} \\ 
    			\hline
    			\textbf{Estimated} & $1.14$ & $19.0$ & $11.29\;watts$ & $28.62\;watts$ & $34.12\;watts$  \\
    			\textbf{Measured}  & $0.73$ & $16.3$ & $7.45\;watts$ & $26.47\;watts$ & $39.98\;watts$  \\
    			\hline
    		\end{tabular}
    	\end{center}
    	\caption{Estimated vs. measured flight performance parameters}
    	\label{table:Compar} 
    \end{table}

    \subsection{Stability Analysis}

    The stability analysis of our design was performed in AVL. Three different straight and level flight trim states and one level turn trim state were analysed. The four cases used are listed in Table~\ref{table:stab-cases}.

    \begin{table}[htb]
    	\begin{center}
    		\begin{tabular}{|c|c|c|}
    			\hline
    			\textbf{Case} & \textbf{Airspeed (in m/s)} & \textbf{Bank Angle (in degrees)} \\ 
    			\hline
    			Case 1 &  $8.5$ &  $0$ \\
    			Case 2 &  $7.0$ &  $0$ \\
    			Case 3 & $10.0$ &  $0$ \\
    			Case 4 &  $8.5$ & $30$ \\
    			\hline
    		\end{tabular}
    	\end{center}
    	\caption{Different cases for stability analysis in AVL}
    	\label{table:stab-cases} 
    \end{table}

    The eigenvalues, frequencies and damping ratios for the different modes are plotted in Figures~\ref{fig:eig},~\ref{fig:freq} and \ref{fig:damp}.

    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS2/SkynetV1_eig.png}
    	\caption{Eigenvalue plot}\label{fig:eig}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS2/SkynetV1_freq.png}
    	\caption{Frequency}\label{fig:freq}
    \end{figure}
    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=0.7\textwidth]{Figures/PS2/SkynetV1_damp.png}
    	\caption{Damping ratio}\label{fig:damp}
    \end{figure}

    \subsection{Three-view drawings of the final design}

    Figure~\ref{fig:CAD} shows the CAD drawings of our final design. Figure~\ref{fig:SW} shows the SolidWorks model of our design that we used to get all the parts for the laser cutter.

    \begin{figure}[h!]
    	\centering
    	\includegraphics[width=\textwidth]{Figures/CAD/Aircraft_Design_3-3.png}
    	\caption{CAD drawings of the final design}\label{fig:CAD}
    \end{figure}

    \begin{figure}[h!]
    	\centering
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/CAD/iso.png}
    		\caption{Isometric view}
    	\end{subfigure}
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/CAD/top.png}
    		\caption{Top view}
    	\end{subfigure}
    	\\
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/CAD/side.png}
    		\caption{Side view}
    	\end{subfigure}
    	\begin{subfigure}[b]{0.49\textwidth}
    		\includegraphics[width=\textwidth]{Figures/CAD/front.png}
    		\caption{Front view}
        \end{subfigure}%
        \caption{Solidworks model screenshots}\label{fig:SW}
    \end{figure}

% AKSHAY & SRAVYA
% Include in this section a Three View Drawing of the Plane


\section{Controls}
	\label{Controls}
	\subsection{Control Strategy}
	\label{CtrlStr}
	\subsection{Flight Performance}
	\label{CtrlFlightPerf}
% BRANDON
% Include in this section Initial Approach vs. Final Choices


\section{Fabrication}
<<<<<<< HEAD
	\label{Fabrication}
	\subsection{Prototype Construction Approach}
	\label{ProtoConsAppr}
	\subsubsection{Mk-I "The Red Baron"}
	\label{mk1}
	\subsubsection{Mk-II "The Pig"}
	\label{mk2}
	\subsubsection{Mk-III.1}
	\label{mk3.1}
	\subsubsection{Mk-III.2 "Ronald McDonald"}
	\label{mk3.2}
	\subsubsection{Mk-III.2 "Terminator"}
	\label{mk3.3}
	\subsubsection{Mk-III.2 "The UltraLight"}
	\label{mk3.4}
=======
\label{Fabrication}
\subsection{Prototype Construction Approach}
\label{ProtoConsAppr}
\subsubsection{Mk-I "The Red Baron"}
\label{mk1}
\subsubsection{Mk-II "The Pig"}
\label{mk2}
\subsubsection{Mk-III.1}
\label{mk3.1}
\subsubsection{Mk-III.2 "Ronald McDonald"}
\label{mk3.2}
\subsubsection{Mk-III.2 "Terminator"}
\label{mk3.3}
\subsubsection{Mk-III.2 "The UltraLight"}
\label{mk3.4}
>>>>>>> 210f754f4a95fe8bad8791a8c3a916f38f8a1bdd


%%%%%%%%%%%%%%%% Start: Flight Testing %%%%%%%%%%%%%%%%%%%
\section{Flight Testing}
<<<<<<< HEAD
	\label{FlightTesting}
	Over the course of two weeks, before and during the final competition, the flight test team worked extensively to try to successfully implement the strategies described in section \ref{Mission}. It was decided very early during flight testing that the only way to accomplish the task was to add sections of the mission incrementally. A strategy of "coding at night, flying in the morning" was implemented and each section of the mission was tested in a simulator, tested during flight and gradually changed to improve performance and accommodate realistic goals.

	\subsection{Flight Test Approach}
	\label{FltTstAppr}
	Flight testing was split into three major sections: Waypoint Navigation, Phase 1 testing and Phase 2 testing. The goal of waypoint navigation was to successful traverse a spiral given a set number of waypoints. Phase 1 testing included all sections of flight before a time of sight for all targets is found. Phase 2 testing included the refinement process for each target and on board calculations of estimated target locations.

	\subsubsection{Waypoint Navigation}
	The entire mission consists of flying one spiral around the center of the lake to find all targets and flying circles around constantly changing centroids during target refinement. This is much different from the line transitioning which was the goal of problem set 3. During flight testing, the line transitioning algorithm presented in problem set 3 proved to be unfavorable. A small change was made to the algorithm to be able to smoothly traverse waypoints in a circular pattern.\\

	As a reminder, in problem set 3, waypoint vectors point between waypoints while the plane vector always points from the plane to the current waypoint. These are used to compute a heading error which is then coupled with a proportional gain to compute a heading command. If the waypoint is found within a certain specified error radius, the plane will head towards the next waypoint. For sprials, the following new equations are used to compute waypoint heading vector angles,
	\begin{align*}
		\mbox{For a circular path: } H_{wp} &= atan2((y_{wp}-y_{centroid}),(x_{wp}-x_{centroid})) + \pi /2 \\
		\mbox{For transition between spirals: } H_{wp} &= atan2((y_{wp,i+1}-y_{wp,i}),(x_{wp,i+1}-x_{wp,i}))
	\end{align*}
	where $(x_{wp},y_{wp})$ are waypoint locations. The first equation forces the plane to track a line tangent to a circle centered around a specified centroid $(x_{centroid},y_{centroid})$. For the spiral, the centroid is set to $(0,0)$. For phase 2 refinement, the centroid is changes according to target locations. The second equation is forces the plane to track a line between waypoints. This is essential for moving between inner circles of the spiral. During flight testing, these proved to be the most robust.\\

	To improve reliability, a check was made to ensure the plane would always move towards a waypoint. If the plane was outside a 45 degree field of view of the waypoint or if the plane was within 10 meters of a waypoint, the plane was commanded to move directly towards the waypoint. The figure below shows an example of the algorithm during a test flight,

	\subsubsection{Phase 1 testing}
	At the start of a mission, the plane is commanded to increase in altitude at a maximum climb rate to a specified altitude. Once the altitude is reached, the plane flies through a series of transition points which help it navigate into a spiral more smoothly. Once the spiral is initiated, snapshots are taken at each waypoint to ensure maximum coverage of the entire area. Phase 1 transitions into phase 2 once all targets are acquired. If all targets are not found within the spiral, the plane reinitializes a new spiral.\\

	First, the mission spiral was tested without taking snapshots to ensure the waypoint navigation was working correctly. We ran into two major problems with the APM board and the Starduplane code during this phase of testing.
	\begin{enumerate}
		\item \textbf{Flash Memory Problem:} In problem set 3, we ran into memory issues when the majority of our code was written in classes and dynamically allocatable containers. This time, the memory issue arose because of the amount of floats being stored. When a dynamically allocatable array allocates more memory during runtime when there is no more memory to allocate, the APM board seems to overwrite other memory addresses. To avoid this issue and weird behaviors during flight time (Nose Dives!), static arrays were created so that an error message would be received during compile time. Unfortuanely, storing the 52 waypoints required for the spiral (104 floats) was too much for the APM board.
		\item \textbf{Initialization Problem:} A major problem arises when trying to limit a command to only happen once during initialization of auto mode. Using only the "just switched to AUTO" logic found in Starduplane does not ensure that a command only happens once during auto mode. This may be caused by the fact that sometimes it may take longer than 100 ms to return to the fast loop.
	\end{enumerate}

	Both of these issues took an extensive amount of time to fix. After going through several iterations, the following solutions were concluded.
	\begin{enumerate}
		\item \textbf{Solution to Flash Memory Problem:} To limit the amount of static floats stored in flash during phase 1, a function was created to produce waypoints on the fly during the spiral. An optimal spiral function is created depending on the location where the initial climb to max altitude ends. The spiral changes on each run but this ensures that the plane starts the spiral as close as possible and that flash memory isn't filled with waypoint data.
		\item \textbf{Solution to Initialization issues:} To ensure that a spiral is only created once during auto mode, a parameter is created to act as a flag. Before a mission is flown, the parameter is set to zero in Mission Planner. Once the program initializes the spiral, the flag is set to 1 and the program can no longer initialize a spiral.
	\end{enumerate}

	Once these bugs were fixed, the team was able to implement snapshot capturing. Snapshots must be taken at each waypoint during the spiral to ensure maximum coverage of the entire area. If a snapshot is not captured at a waypoint, the plane circles around the waypoint until a snapshot is taken. To limit the amount of waypoint misses, the waypoints were spread further apart. An snapshot error was set to 5 meters so that snapshots/waypoints were guaranteed to be hit within a 5 meter radius. The airspeed was also reduced to 11 m/s.\\

	One of the last features implemented in phase 1 was a controlled climb with snapshots...
=======
\label{FlightTesting}
Over the course of two weeks, before and during the final competition, the flight test team worked extensively to try to successfully implement the strategies described in section \ref{Mission}. It was decided very early during flight testing that the only way to accomplish the task was to add sections of the mission incrementally. A strategy of "coding at night, flying in the morning" was implemented and each section of the mission was tested in a simulator, tested during flight and gradually changed to improve performance and accommodate realistic goals.

\subsection{Flight Test Approach}
\label{FltTstAppr}
Flight testing was split into three major sections: Waypoint Navigation, Phase 1 testing and Phase 2 testing. The goal of waypoint navigation was to successful traverse a spiral given a set number of waypoints. Phase 1 testing included all sections of flight before a time of sight for all targets is found. Phase 2 testing included the refinement process for each target and on board calculations of estimated target locations.

\subsubsection{Waypoint Navigation}
The entire mission consists of flying one spiral around the center of the lake to find all targets and flying circles around constantly changing centroids during target refinement. This is much different from the line transitioning which was the goal of problem set 3. During flight testing, the line transitioning algorithm presented in problem set 3 proved to be unfavorable. A small change was made to the algorithm to be able to smoothly traverse waypoints in a circular pattern.\\

As a reminder, in problem set 3, waypoint vectors point between waypoints while the plane vector always points from the plane to the current waypoint. These are used to compute a heading error which is then coupled with a proportional gain to compute a heading command. If the waypoint is found within a certain specified error radius, the plane will head towards the next waypoint. For sprials, the following new equations are used to compute waypoint heading vector angles,
\begin{align*}
\mbox{For a circular path: } H_{wp} &= atan2((y_{wp}-y_{centroid}),(x_{wp}-x_{centroid})) + \pi /2 \\
\mbox{For transition between spirals: } H_{wp} &= atan2((y_{wp,i+1}-y_{wp,i}),(x_{wp,i+1}-x_{wp,i}))
\end{align*}
where $(x_{wp},y_{wp})$ are waypoint locations. The first equation forces the plane to track a line tangent to a circle centered around a specified centroid $(x_{centroid},y_{centroid})$. For the spiral, the centroid is set to $(0,0)$. For phase 2 refinement, the centroid is changes according to target locations. The second equation is forces the plane to track a line between waypoints. This is essential for moving between inner circles of the spiral. During flight testing, these proved to be the most robust.\\

To improve reliability, a check was made to ensure the plane would always move towards a waypoint. If the plane was outside a 45 degree field of view of the waypoint or if the plane was within 10 meters of a waypoint, the plane was commanded to move directly towards the waypoint. The figure below shows an example of the algorithm during a test flight,

\subsubsection{Phase 1 testing}
At the start of a mission, the plane is commanded to increase in altitude at a maximum climb rate to a specified altitude. Once the altitude is reached, the plane flies through a series of transition points which help it navigate into a spiral more smoothly. Once the spiral is initiated, snapshots are taken at each waypoint to ensure maximum coverage of the entire area. Phase 1 transitions into phase 2 once all targets are acquired. If all targets are not found within the spiral, the plane reinitializes a new spiral.\\

First, the mission spiral was tested without taking snapshots to ensure the waypoint navigation was working correctly. We ran into two major problems with the APM board and the Starduplane code during this phase of testing.
\begin{enumerate}
\item \textbf{Flash Memory Problem:} In problem set 3, we ran into memory issues when the majority of our code was written in classes and dynamically allocatable containers. This time, the memory issue arose because of the amount of floats being stored. When a dynamically allocatable array allocates more memory during runtime when there is no more memory to allocate, the APM board seems to overwrite other memory addresses. To avoid this issue and weird behaviors during flight time (Nose Dives!), static arrays were created so that an error message would be received during compile time. Unfortuanely, storing the 52 waypoints required for the spiral (104 floats) was too much for the APM board.
\item \textbf{Initialization Problem:} A major problem arises when trying to limit a command to only happen once during initialization of auto mode. Using only the "just switched to AUTO" logic found in Starduplane does not ensure that a command only happens once during auto mode. This may be caused by the fact that sometimes it may take longer than 100 ms to return to the fast loop.
\end{enumerate}

Both of these issues took an extensive amount of time to fix. After going through several iterations, the following solutions were concluded.
\begin{enumerate}
\item \textbf{Solution to Flash Memory Problem:} To limit the amount of static floats stored in flash during phase 1, a function was created to produce waypoints on the fly during the spiral. An optimal spiral function is created depending on the location where the initial climb to max altitude ends. The spiral changes on each run but this ensures that the plane starts the spiral as close as possible and that flash memory isn't filled with waypoint data.
\item \textbf{Solution to Initialization issues:} To ensure that a spiral is only created once during auto mode, a parameter is created to act as a flag. Before a mission is flown, the parameter is set to zero in Mission Planner. Once the program initializes the spiral, the flag is set to 1 and the program can no longer initialize a spiral.
\end{enumerate}

Once these bugs were fixed, the team was able to implement snapshot capturing. Snapshots must be taken at each waypoint during the spiral to ensure maximum coverage of the entire area. If a snapshot is not captured at a waypoint, the plane circles around the waypoint until a snapshot is taken. To limit the amount of waypoint misses, the waypoints were spread further apart. An snapshot error was set to 5 meters so that snapshots/waypoints were guaranteed to be hit within a 5 meter radius. The airspeed was also reduced to 11 m/s.\\

One of the last features implemented in phase 1 was a controlled climb with snapshots...
>>>>>>> 210f754f4a95fe8bad8791a8c3a916f38f8a1bdd

%%%%%%%%%% Brandon please add Phase 1 - Climb flight testing here %%%%%%%%%%%

By taking snapshots while climbing at the center, we were able to sometimes get lucky and capture a target before going into a spiral.

\subsubsection{Phase 2 testing}
%%%%% Akshay please add everything you can about the flight testing of Phase 2 here %%%%%
% Step 1: adding phase 2 simple
% Step 2: removing phase 2 simple and adding all of the refinement
% what sections were tested first, second, third, etc...
% Problems we had: Flash memory issue with storing snapshots, the dreaded unsigned int...
%%%%% Akshay please add everything you can about the flight testing of Phase 2 here %%%%%

\subsection{Simulation vs. Actual Tests}
\label{simvsact}
%%% Kartikey please summarize the differences between your envisioned mission plan and what the plane actually does %%%
<<<<<<< HEAD
=======

%%%%%%%%%%%%%%%% End: Flight Testing %%%%%%%%%%%%%%%%%%%

>>>>>>> 210f754f4a95fe8bad8791a8c3a916f38f8a1bdd

%%%%%%%%%%%%%%%% End: Flight Testing %%%%%%%%%%%%%%%%%%%


\section{Mission Flight Results}
	\label{MissionFlightResults}
	\subsection{Official Flight Results}
	\label{OffFltRes}
	\begin{table}[!ht]
		\begin{center}
			\begin{tabular}{ | c | c | c | c | c | p{3cm} |}
				\hline
				\textbf{Flight} & \textbf{Date} & \textbf{Phase 1} & \textbf{Phase 2} & \textbf{Total} & \textbf{Comments} \\ \hline
				1 & 6/6/2014 &  &  & 76.84 & \\ \hline
				2 & 6/6/2014 &  &  & 50.26 & Dropped\\ \hline
				3 & 6/6/2014 &  &  & 25.27 & Dropped\\ \hline
				4 & 6/6/2014 &  &  & 74.61 & \\ \hline
				5 & 6/6/2014 &  &  & 35.76 & Dropped\\ \hline
				Overall & \multicolumn{5}{c|}{75.725}\\ \hline   
			\end{tabular}
			\caption{Official Flight Results}
			\label{flighttab}
		\end{center}
	\end{table}

	\subsection{Analysis of Flight Data}
	\label{AnalFltData}
% JERRY & KARTIKEY
% Include observations about about the validity of our approach.
% What observations from the data might inform future work (beyond the scope of the class).


\section{Conclusions \& Lessons Learned}
	\label{Conclusion}
% EVERYONE

\section{Future AA241X Recommendations}
	\label{Recommendations}
% EVERYONE

\end{document}
